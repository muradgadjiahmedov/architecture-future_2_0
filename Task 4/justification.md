# Task4 — Обоснование Terraform-конфигурации (IaaS + IaC)

## 1) Что разворачивается Terraform, а что вручную

### Terraform-managed
- **Network:** VPC, public/private subnet, route tables, Internet Gateway
- **NAT:** Elastic IP + NAT Gateway (для выхода приватных узлов в интернет без публичных IP)
- **Security:** Security Groups (SSH на bastion; SSH/внутренний трафик в private)
- **Compute:** Bastion VM (public), private data nodes (VM)
- **Storage:** дополнительные EBS disks для data nodes (раздельные “data volumes”)

### Manually (однократно)
- Создание/настройка **Cloud Account** (billing, лимиты, policy)
- Подготовка **SSH key pair** (или можно тоже сделать Terraform-ом, но в курсе часто допускают вручную)
- Включение нужных сервисов/квот в облаке (если требуется)
- Наполнение ВМ приложениями (Kafka/Airflow/Lakehouse) — это уже следующий слой (Configuration Mgmt)

Такое разделение соответствует заданию: Terraform отвечает за воспроизводимую инфраструктуру IaaS, а “ручное” остаётся только там, где обычно есть организационные/безопасностные предпосылки.

---

## 2) Почему именно такая сеть

### Public + Private subnets
- **Public subnet:** только bastion и NAT. Это минимизирует “поверхность атаки”.
- **Private subnet:** data platform узлы (Kafka/Airflow/ETL workers/служебные VM).  
  Они не имеют публичных IP и доступны только через bastion.

### NAT Gateway
Нужен, чтобы private узлы могли:
- тянуть пакеты/обновления,
- ходить в managed-сервисы/репозитории,
- но при этом **не светить** внешние IP у приватных VM.

В конфигурации выбран **single NAT** (дешевле и проще). Для production-HA можно сделать NAT per-AZ.

---

## 3) Почему такие размеры VM и дисков

### Bastion: t3.micro
- роль: “jump host” (SSH и базовые утилиты)
- нагрузки минимальные → достаточно маленького инстанса, экономия бюджета.

### Data nodes: t3.large + data disk 200 GB (gp3)
- t3.large как “разумный старт” для сервисов данных в MVP (2 узла)
- отдельный диск 200 GB под “данные” (логи/буферы/локальные state) позволяет:
  - отделить OS-диск от рабочих данных,
  - быстрее масштабировать объёмы и делать расширение дисков.

Для реальной эксплуатации параметры подбираются по профилю нагрузки (IOPS/throughput/CPU/RAM).

---

## 4) Зачем декларативный подход и IaC

### Декларативность Terraform
- Описываем **целевое состояние**, а Terraform сам приводит инфраструктуру к нему.
- Меньше человеческих ошибок по сравнению с “кликами в консоли”.

### Воспроизводимость и масштабируемость
- Один и тот же код разворачивает одинаковую инфраструктуру в dev/stage/prod.
- Можно быстро:
  - увеличить количество data nodes,
  - расширить диски,
  - добавить AZ (поднять HA),
  - включить дополнительные подсети/SG.

### Контроль изменений
- `terraform plan` — видим, что изменится, до применения.
- Код в репозитории → ревью в PR → прозрачность и аудит.

---

## 5) Как это связано с бизнес-целями

- **Быстрая отчётность:** private data nodes + возможность масштабирования compute/storage.
- **Независимость доменов:** безопасная изоляция контуров и управляемая сеть.
- **Подключение новых направлений:** расширяем инфраструктуру добавлением узлов/подсетей без ручного труда.
- **ИБ/регуляторика:** минимум публичных компонентов, контроль доступа через SG + bastion.
